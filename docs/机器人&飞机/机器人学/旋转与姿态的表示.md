# 旋转与姿态的表示

## 参考书目

《机器人建模与控制》[美] Mark W. Spong, Seth Hutchinson, M. Vidyasager

## 1 旋转矩阵

$$\begin{aligned} _1^0 R &= \begin{bmatrix}
  x_0 \cdot x_1 & x_0 \cdot y_1 & x_0 \cdot z_1 \\
  y_0 \cdot x_1 & y_0 \cdot y_1 & y_0 \cdot z_1 \\
  z_0 \cdot x_1 & z_o \cdot y_1 & z_0 \cdot z_1
\end{bmatrix}\\
&= \begin{bmatrix}^0\mathbf{x}_1 & ^0\mathbf{y}_1 & ^0\mathbf{z}_1\end{bmatrix}\\
&= \begin{bmatrix}^1\mathbf{x}_0 \\ ^1\mathbf{y}_0 \\ ^1\mathbf{z}_0\end{bmatrix}
\end{aligned}$$

这里的 $x_0, y_0, z_0$ 是坐标系 0 的三个单位向量，$x_1, y_1, z_1$ 是坐标系 1 的三个单位向量。要求，坐标系 0 和坐标系 1 的**原点是重合的**。

矩阵既表示

**三维坐标系 $o_1x_1y_1z_1$ 相对于参考系 $o_0x_0y_0z_0$ 的姿态角**

也描述了

**从三维坐标系 1 到三维坐标系 0 的旋转坐标变换**

此外，还可以看作

**在固定坐标系0中的一个旋转操作符**。

对于一个隶属于坐标系 1 的向量 $^1 A = \begin{bmatrix} ^1x_{a} \\ ^1y_{a} \\ ^1z_{a} \end{bmatrix}$ ，可以用 $_1^0 R \cdot (^1A)$ 的方式计算该向量在坐标系 0 下的表示方式 $^0A$ 。

**理解**：$_1^0 R$ 将坐标系 1 的基在坐标系 0 下重新表示了一遍。

**性质**：

1. $(_1^0 R)^{\top} = (_1^0 R)^{-1} = (_0^1 R)$ 。
2. 旋转矩阵是一个正交矩阵。（正交矩阵：每个列/行向量具有单位长度并且相互垂直，即满足 $A^TA = E$ 。）

#### 基本旋转矩阵

$$ R_{z, \psi} = \begin{bmatrix}
  \cos\psi & -\sin \psi & 0 \\
  \sin \psi & \cos \psi & 0 \\
  0 & 0 & 1
\end{bmatrix}$$

$$ R_{x, \phi} = \begin{bmatrix}
  1 & 0 & 0 \\
  0 & \cos \phi & -\sin\phi \\
  0 & \sin\phi & \cos\phi
\end{bmatrix} $$

$$ R_{y, \theta} = \begin{bmatrix}
  \cos\theta & 0 & \sin\theta \\
  0 & 1 & 0 \\
  -\sin\theta & 0 & \cos\theta
\end{bmatrix}$$

## 2 相似变换

如果 A 描述了一个线性变换在坐标系 1 中的表示，B 描述了同一个线性变换在坐标系 0 中的表示，则有：

$$ B = (_1^0R) A (_0^1R) $$

**理解**：以 $(^0\zeta) = B \cdot (^0\alpha) = (_1^0R) A (_0^1R)\cdot (^1\alpha)$ 为例

1. $\beta = (_0^1R)\cdot (^1\alpha)$：将 $^0\alpha$ 向量转换到坐标系 1 内，得到 $^1\beta$ 向量。
2. $\gamma = A \beta$ ：对 $^1\beta$ 作线性变换 A，得到 $^1\gamma$ 向量。
3. $(^0\zeta) = B(^0\alpha) = (_1^0R) \gamma$ ：将 $^1\gamma$ 向量转换回坐标系 0，得到 $^0\zeta$ 向量。

## 3 任意旋转的最小参数化

三维空间的旋转一共拥有三个自由度，但在实际工程中，我们一般选四个量作为任意旋转的最小参数化表示：

1. 欧拉角表示：欧拉角顺序和三个欧拉角的值
2. 等轴角表示：旋转轴和旋转角度
3. 四元数表示：四元数

### 3.1 欧拉角

欧拉角表示法将一个任意旋转拆分为三次基本旋转，通过指定三次旋转的旋转轴和旋转角度来表示任意一个旋转。

注意，每次旋转都绕着机体坐标系的某根轴。

#### 欧拉角 -> 旋转矩阵

一般来说，我们规定绕 $X$ 轴旋转的角度为 $\phi$，绕 $Y$ 轴旋转的角度为 $\theta$，绕 $Z$ 轴旋转的角度为 $\psi$ .

我们给出一些结论：

$$R_{XYZ} = \begin{bmatrix}
c\theta c\psi & -c\theta s\psi & s\theta \\
s\phi s\theta c\psi + c\phi s\psi & -s\phi s\theta s\psi + c\phi c\psi & -s\phi c\theta \\
-c\phi s\theta c\psi + s\phi s\psi & c\phi s\psi s\theta + s\phi c\phi & c\phi c\theta
\end{bmatrix}$$

$$R_{ZYX} = \begin{bmatrix}
c\psi c\theta & -s\psi c\phi + c\psi s\theta s\phi & s\psi s\phi + c\psi s\theta c\phi\\
s\psi c\theta & c\psi c\phi + s\psi s\theta s\phi & -c\psi s\phi + s\psi s\theta c\phi\\
-s\theta & c\theta s\phi & c\theta c\phi
\end{bmatrix}$$

#### 欧拉角奇异点（万向节死锁）

我们以 $ZY'X''$ 欧拉角为例，当绕 $Y'$ 轴转动的 Pitch 角度 $\theta$ 是 $\pi/2$ 的奇数倍时，$X''$ 轴和 $Z$ 轴重合了，此时 $\phi$ 和 $\psi$ 有无穷多种可能，无法确定。这就是**欧拉角的奇异点**，该现象又称**万向节死锁**。

### 3.2 等轴角表示

#### 等轴角表示 -> 旋转矩阵

$$ R_{k, \theta} = \begin{bmatrix}
k_x^2v_{\theta}+c_{\theta} & k_xk_yv_{\theta}-k_zs_{\theta} & k_xk_zv_{\theta}+k_ys_{\theta}\\ k_xk_yv_{\theta}+k_zs_{\theta} & k_y^2v_{\theta}+c_{\theta} & k_yk_zv_{\theta}-k_xs_{\theta}\\ k_xk_zv_{\theta}-k_ys_{\theta} & k_yk_zv_{\theta}+k_xs_{\theta} & k_z^2v_{\theta}+c_{\theta}
\end{bmatrix} $$

其中，$v_{\theta} = vers(\theta) = 1 - c_{\theta}$ ，$k$是单位向量$\begin{bmatrix}k_x & k_y & k_z\end{bmatrix}^{\top}$ .

#### 旋转矩阵 -> 等轴角表示

若已知一个等轴角表示的旋转矩阵：

$$R_{\mathbf{k}, \theta} = \begin{bmatrix}
r_{11} & r_{12} & r_{13}\\
r_{21} & r_{22} & r_{23}\\
r_{31} & r_{32} & r_{33}
\end{bmatrix}$$

则有

$$\theta = \arccos \frac{r_{11} + r_{22} + r_{33} - 1}{2}$$

$$\mathbf{k} = \frac{1}{2\sin\theta}\begin{bmatrix}r_{32} - r_{23}\\ r_{13} - r_{31}\\ r_{21} - r_{12}\end{bmatrix}$$

### 3.3 四元数

四元数的详细内容参见 [quaternion. Yan-Bin Jia, 2024.](./旋转与姿态的表示.assets/quaternion.pdf)

四元数 $v = w+xi+yj+zk$ 其中 $i,j,k$ 可以视为三个垂直的坐标轴，满足叉乘关系。

#### 等轴角表示转四元数

四元数和等轴角表示的旋转矩阵有如下转换关系：

$$w = \cos(\theta/2), x = \sin(\theta/2)k_x, y = \sin(\theta/2)k_y, z = \sin(\theta/2)k_z$$

#### 四元数转旋转矩阵

$$R = \begin{bmatrix}
1-2y^2-2z^2 & 2xy-2wz & 2wy+2xz \\
2xy+2wz & 1-2x^2-2z^2 & 2yz-2wx \\
2xz-2wy & 2wx+2yz & 1-2x^2-2y^2
\end{bmatrix}$$

#### 四元数乘法

设两个四元数分别为 $p = p_0 + \mathbf{p}$ 和 $q = q_0 + \mathbf{q}$ ，则其乘法定义为

$$p\otimes q = p_0q_0 - \mathbf{p} \cdot \mathbf{q} + p_0 \mathbf{q} + q_0 \mathbf{p} + \mathbf{p} \times \mathbf{q}$$

该定义其实就是将两个四元数相乘展开化简的结果。其中 $i,j,k$ 按照叉乘的规定计算，即 $ij = k, jk = i, ki = j, ji = -k, kj = -i, ik = -j$ 。

#### 四元数导数

对于一个含时间参数的单位四元数 $\hat{q}(t) = (q_0, \mathbf{q})$ （描述了刚体相对于世界坐标系的姿态变化），以及定义在自身坐标系下的角速度对应的四元数 $^B\omega(t) = \left(0, \boldsymbol{\omega}(t)\right)$ ，则有

$$\dot{\hat{q}} = \frac{1}{2} \hat{q} \otimes \ ^B\omega$$

证明详见上文参考资料的 14-16 页。

我们更加深入一点，有

$$\begin{aligned}
\dot{\hat{q}} &= \frac{1}{2} \hat{q} \otimes \ ^B\omega\\
&= \frac{1}{2}\left(-\mathbf{q}\cdot \boldsymbol{\omega} + q_0 \boldsymbol{\omega} + \mathbf{q} \times \boldsymbol{\omega} \right)
\end{aligned}$$

所以

$$\dot{q_0} = -\frac{1}{2}\mathbf{q}^{\top}\boldsymbol{\omega},\ \ \dot{\mathbf{q}} = \frac{1}{2} \left(q_0 \mathbf{I}_{3\times3} + \mathbf{q}^{\vee} \right) \boldsymbol{\omega}$$

## 4 齐次变换

齐次变换利用 SE(3) 中的矩阵来描述刚性运动：平移和旋转。

$$
T = \begin{bmatrix} \mathbf{R}_{3\times 3} & \mathbf{t}_{3\times 1}\\ \mathbf{0}^T & 1 \end{bmatrix}
$$

其中，$\mathbf{R} \in \mathrm{SO}(3)$ 是一个旋转矩阵，$\mathbf{t} \in \mathbb{R}^3$ 是一个平移向量。
